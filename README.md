# Blowing Simulator

## Main Features & Navigation

The Blowing Simulator web app provides the following main features, accessible from the index page:

- **Fremco**: Navigate to `/create-fremco` for Fremco report creation.
- **Jetting**: Navigate to `/create-jetting` for Jetting report creation.
- **Export Report**: Upload a PDF and process it via `/pdf2text` to extract and summarize measurements.

### Main Handlers

| Handler/Route         | Description                                 |
|---------------------- |---------------------------------------------|
| `/pdf2text`           | PDF to Text conversion and report export    |
| `/create-fremco`      | Create Fremco report                        |
| `/create-jetting`     | Create Jetting report                       |
| `/download-json`      | Download processed report as JSON           |
| `/download-csv`       | Download processed report as CSV            |
| `/download-pdf`       | Download processed report as PDF            |
| `/jetting-report`     | View Jetting report                         |

### Index Page

The index page provides:
- Navigation buttons for Fremco and Jetting workflows
- An "Export Report" form to upload and process Jetting PDFs

**How to use:**
1. Go to the main page (`/`).
2. Choose Fremco or Jetting workflow, or use the Export Report form.
3. After uploading a PDF, view and download results in various formats.


A Go web application for extracting, normalizing, and parsing measurement data from Jetting and Fremco PDF reports into a unified JSON format, with a full workflow from PDF upload to HTML report and visualization.

---

## Directory Structure

```
BlowingSimulator/
├── api/                # (empty) Reserved for future API endpoints
├── cmd/
│   ├── blowing-simulator/   # Main web server entrypoint
│   └── parse2json.go        # CLI tool for TXT→JSON parsing
├── docs/               # (empty) Reserved for documentation
├── internal/
│   ├── config/         # (empty) Reserved for configuration logic
│   ├── fremco/         # (empty) Reserved for Fremco-specific logic
│   ├── jetting/        # (empty) Reserved for Jetting-specific logic
│   └── simulator/
│       ├── normalize.go      # Normalization functions for Jetting/Fremco TXT
│       ├── parse_fremco.go   # Fremco TXT parser
│       └── parse_jetting.go  # Jetting TXT parser
├── pkg/                # (empty) Reserved for reusable packages
├── scripts/            # (empty) Reserved for utility scripts
├── test/               # (empty) Reserved for unit tests and sample files
├── web/
│   ├── static/         # Static assets (CSS, JS, images)
│   └── templates/
│       └── pdf2text.html     # Main web UI template
├── go.mod              # Go module definition
├── go.sum              # Go dependencies checksum
```

---

## Project Overview

### Purpose

Blowing Simulator extracts measurement data from PDF reports generated by Jetting and Fremco machines. It normalizes and parses the data into a unified JSON schema for further analysis or export.

### Supported Formats

- **Jetting TXT**: Multiple layouts supported (block, vertical-block, flat-table, row-oriented, and fallback scanning).
- **Fremco MicroFlow LOG**: Table format, parsed using `pdftotext` for reliable extraction.

### Key Features

- **PDF to Text Extraction**:
  - Jetting: Uses Go-native extraction (`ledongthuc/pdf`) for best results with Jetting layouts.
  - Fremco: Uses external `pdftotext` CLI for robust table extraction, ensuring Fremco tables are parsed correctly.
- **Automatic Format Detection**: Detects Jetting or Fremco format based on keywords in the extracted text.
- **Normalization & Parsing**: Cleans up extracted text and parses into rows aligned by distance (`Länge`/`Streckenlänge`), supporting multiple Jetting layouts and Fremco tables.
- **Uniform JSON Output**: Outputs a JSON array of `SimpleMeasurement` objects for both formats:
  - `length` (float64)
  - `speed` (float64)
  - `pressure` (float64)
  - `torque` (int, rounded)
  - `datetime` (optional, if available in source)
- **Web UI**:
  - Upload PDF, view extracted text, view and download JSON.
  - See parsed measurements in a dynamic HTML table.
  - Visualize measurements with a Chart.js multi-axis graph (speed, pressure, torque vs. length).
- **HTML Report**: Professional report with table and graph, matching the look of original machine reports.
- **CLI Tool**: Parse normalized TXT files to JSON outside the web UI for batch or automated processing.

### How It Works

1. **Upload PDF** via the web UI.
2. **Extract text**:
   - Jetting: Go-native extractor.
   - Fremco: `pdftotext` CLI.
3. **Automatic format detection** chooses the correct parser.
4. **Normalize text** to remove artifacts and prepare for parsing.
5. **Parse measurements** into unified JSON rows.
6. **View HTML report**:
   - See extracted text for debugging.
   - See parsed measurements in a table.
   - View a multi-axis graph (speed, pressure, torque vs. length).
7. **Download JSON** or use CLI for batch processing.

---

## Development Notes

- **Extensible**: Directory structure allows for future expansion (API, tests, docs, etc.).
- **Robust Parsing**: Handles noisy extraction, multiple Jetting layouts (block, vertical-block, flat-table, row-oriented, fallback) and Fremco tables, skips incomplete rows.
- **Error Handling**: Fails gracefully if extraction or parsing fails, with clear UI feedback.
- **HTML Report**: Table and graph are generated dynamically from parsed JSON, matching the style of original machine reports.
- **Unit Tests**: (To be added) Place sample TXT files and test cases in `/test`.

---

## Getting Started

1. **Install Go** (>=1.18).
2. **Install pdftotext** (Poppler) for Fremco parsing.
3. **Build and run** the web server:
   ```
   cd BlowingSimulator/cmd/blowing-simulator
   go run main.go
   ```
4. **Upload a PDF** via the web UI.
5. **View the HTML report** with table and graph.
6. **Download the parsed JSON** for further analysis.

---

## Contributing

- Add sample TXT files and unit tests to `/test`.
- Extend normalization and parsing logic in `/internal/simulator/`.
- Improve UI and HTML report in `/web/templates/pdf2text.html`.
- Add new features (CSV export, batch processing, metadata tables, etc.).

---

## License

MIT License (add LICENSE file as needed).

---