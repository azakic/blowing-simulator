# Blowing Simulator

A Go-based web application for processing and analyzing PDF reports from cable blowing operations. Supports both Jetting and Fremco PDF formats with intelligent parsing and data visualization.

## ðŸ“‹ Description

The Blowing Simulator is a comprehensive tool designed for telecommunications and utility companies that perform fiber optic cable installation using pneumatic cable blowing techniques. The application processes PDF protocol reports generated by cable blowing equipment and converts them into structured, analyzable data.

### What is Cable Blowing?

Cable blowing is a method for installing fiber optic cables into underground ducts using compressed air. During the installation process, specialized equipment monitors various parameters like:

- **Distance/Length**: How far the cable has been blown
- **Speed**: Rate of cable installation (m/min)  
- **Pressure**: Air pressure in the duct system (bar)
- **Torque**: Rotational force applied to the cable (%)
- **Temperature**: Environmental and equipment temperature (Â°C)
- **Force**: Pushing/pulling force applied (N)
- **Time**: Duration and timestamps of the operation

### Supported Equipment Formats

**Fremco Systems:**
- Fremco MicroFlow LOG equipment
- SpeedNet-System protocols
- Comprehensive equipment specifications (nozzles, pipes, cables, compressors)
- Weather data and GPS coordinates
- Detailed measurement logging with timestamps

**Jetting Systems:**
- Generic jetting equipment protocols
- German language field names (StreckenlÃ¤nge, Geschwindigkeit, etc.)
- Simplified equipment data structure
- High-frequency measurement capture

### Key Features

- **Automatic Format Detection**: Intelligently identifies whether a PDF is from Fremco or Jetting equipment
- **Dual Parsing Engines**: Uses appropriate extraction method for each format (pdftotext for Fremco, Go native for Jetting)
- **Database Storage**: Stores complete protocol data in PostgreSQL with full metadata preservation
- **Web Interface**: User-friendly upload and visualization interface
- **Data Export**: JSON and CSV export capabilities for further analysis
- **Report Generation**: PDF report creation from parsed data
- **Comprehensive Logging**: Tracks parsing operations and equipment performance

## ðŸš€ Quick Start

### Using Docker (Recommended)

```bash
# Clone the repository
git clone <repository-url>
cd blowing-simulator

# Start the application with Docker Compose
docker compose up -d

# Access the web interface
open http://localhost:8080
```

### Manual Setup

```bash
# Install dependencies (Ubuntu/Debian)
sudo apt-get install poppler-utils

# Build and run
go build -o blowing-simulator ./cmd/blowing-simulator
./blowing-simulator
```

## ðŸ“ Project Structure

```
blowing-simulator/
â”œâ”€â”€ cmd/blowing-simulator/          # Main application
â”‚   â”œâ”€â”€ main.go                     # Web server & PDF processing
â”‚   â”œâ”€â”€ db.go                       # Database operations
â”‚   â””â”€â”€ download_json_handler.go    # Export functionality
â”œâ”€â”€ internal/                       # Core business logic
â”‚   â”œâ”€â”€ simulator/                  # PDF parsing engines
â”‚   â”‚   â”œâ”€â”€ parse_fremco.go        # Fremco PDF parser (pdftotext)
â”‚   â”‚   â”œâ”€â”€ parse_jetting.go       # Jetting PDF parser (Go native)
â”‚   â”‚   â””â”€â”€ normalize.go           # Text normalization
â”‚   â”œâ”€â”€ config/                    # Configuration management
â”‚   â”œâ”€â”€ fremco/                    # Fremco-specific logic
â”‚   â””â”€â”€ jetting/                   # Jetting-specific logic
â”œâ”€â”€ web/templates/                 # Frontend templates
â”‚   â”œâ”€â”€ pdf2text.html             # Main PDF processing interface
â”‚   â”œâ”€â”€ index.html                 # Landing page
â”‚   â””â”€â”€ report/                    # Report templates
â”œâ”€â”€ migrations/                    # Database schema
â”œâ”€â”€ docker-compose.yml             # Multi-container setup
â”œâ”€â”€ Dockerfile                     # Container configuration
â””â”€â”€ README.md                      # This file
```

## ðŸ” Supported PDF Formats

### Jetting PDFs
- **Extraction Method**: Go native library (`github.com/ledongthuc/pdf`)
- **Data Format**: Vertical columns or individual lines
- **Fields**: German field names (LÃ¤nge[m], Lufttemperatur[Â°C], etc.)
- **Example Filename**: `29.10.2025, 11 20, Eiermarkt 15 B NVT 1V2200.pdf`

### Fremco PDFs  
- **Extraction Method**: pdftotext CLI tool with `-layout` flag
- **Data Format**: Horizontal table format
- **Fields**: English field names (Length, Speed, Pressure, etc.)
- **Example Filename**: `SM209214964_2025-10-22 10_51_Oldenburger Koppel_10_NVT1V3400.pdf`

## ðŸ“Š Data Processing Pipeline

1. **Format Detection**: Automatically identifies Jetting vs Fremco format
2. **PDF Extraction**: Uses appropriate extraction method per format
3. **Text Normalization**: Cleans and standardizes extracted text
4. **Data Parsing**: Converts to structured measurement data
5. **Visualization**: Generates tables and charts
6. **Export**: Provides JSON/CSV download options

## ðŸŽ¯ Key Features

### Intelligent Format Detection
```go
// Fremco indicators (processed first - higher priority)
if strings.Contains(rawStr, "Streckenabschnitt") || 
   strings.Contains(rawStr, "Fremco") ||
   strings.Contains(rawStr, "StreckenlÃ¤nge [m]") {
   // Use pdftotext extraction
}

// Jetting indicators  
if strings.Contains(rawStr, "LÃ¤nge") && 
   strings.Contains(rawStr, "Schubkraft") {
   // Use Go native extraction
}
```

### Dual Parser Architecture
- **SimpleMeasurement**: Fremco format (5 columns)
- **JettingMeasurement**: Jetting format (6 columns with German fields)

### Smart Data Display
- Shows `0.0` values when actual zeros exist
- Hides empty cells for missing data
- Dynamic table headers based on format
- Responsive chart visualization

## ðŸ”§ Configuration

### Environment Variables
- `PORT`: Web server port (default: 8080)
- `DATABASE_URL`: PostgreSQL connection string (optional)

### Docker Compose Services
- **app**: Go application server
- **db**: PostgreSQL database (persistent volume)

## ðŸ“ˆ Usage Examples

### Processing a Jetting PDF
1. Upload PDF through web interface
2. System detects Jetting format automatically
3. Extracts data using Go library
4. Displays 6-column table with German headers
5. Shows measurement chart with multiple datasets

### Processing a Fremco PDF
1. Upload PDF through web interface  
2. System detects Fremco format automatically
3. Extracts data using pdftotext
4. Displays 5-column table with English headers
5. Shows measurement chart with torque/pressure data

## ðŸ›  Development

### Adding New PDF Formats
1. Add detection logic in `main.go`
2. Create new parser in `internal/simulator/`
3. Define measurement structure
4. Update frontend templates

### Database Schema
See `migrations/001_create_universal_schema.sql` for complete schema.

## ðŸ› Troubleshooting

### "pdftotext: executable file not found"
- **Docker**: Ensure `poppler-utils` is in Dockerfile
- **Manual**: Install with `apt-get install poppler-utils`

### "No measurement data found"
- Check PDF format matches expected structure
- Verify text extraction in "Extracted Text (Raw)" section
- Check debug logs: `docker logs blowing-simulator-app-1`

### ARM64 Compatibility
Application builds natively for ARM64 (Apple Silicon, Raspberry Pi).

## ðŸ“ Technologies Used

- **Backend**: Go 1.24, Gorilla Mux
- **Database**: PostgreSQL, SQLite
- **PDF Processing**: pdftotext, ledongthuc/pdf
- **Frontend**: HTML5, Chart.js, Bootstrap
- **Containerization**: Docker, Docker Compose
- **Architecture**: ARM64, x86_64

## ðŸ—ºï¸ API Routes

| Route | Method | Description |
|-------|--------|-------------|
| `/` | GET | Main landing page |
| `/pdf2text` | GET/POST | PDF processing interface |
| `/create-fremco` | GET/POST | Fremco report creation |
| `/create-jetting` | GET/POST | Jetting report creation |
| `/download-json` | POST | Export as JSON |
| `/download-csv` | POST | Export as CSV |
| `/download-pdf` | POST | Export as PDF |
| `/jetting-report` | GET | View Jetting reports |

## ðŸ“‹ Measurement Data Structures

### Jetting Format (German)
```go
type JettingMeasurement struct {
    Length      float64 `json:"lÃ¤nge_m"`                    // LÃ¤nge[m]
    Temperature float64 `json:"lufttemperatur_c"`           // Lufttemperatur[Â°C]
    Force       float64 `json:"schubkraft_n"`               // Schubkraft[N]
    Pressure    float64 `json:"einblasdruck_bar"`           // Einblasdruck[bar]
    Speed       float64 `json:"geschwindigkeit_m_min"`      // Geschwindigkeit[m/min]
    Time        string  `json:"zeit_dauer_hh_mm_ss"`        // Zeit - Dauer[hh:mm:ss]
}
```

### Fremco Format (English)
```go
type SimpleMeasurement struct {
    Length   float64 `json:"length"`   // StreckenlÃ¤nge [m]
    Speed    float64 `json:"speed"`    // Geschwindigkeit [m/min]
    Pressure float64 `json:"pressure"` // Rohr-Druck [bar]
    Torque   float64 `json:"torque"`   // Drehmoment [%]
    Time     string  `json:"time"`     // Uhrzeit [hh:mm:ss]
}
```

## ðŸŽ¨ Frontend Features

- **Responsive Design**: Works on desktop and mobile
- **Dynamic Tables**: Auto-adjusting columns based on format
- **Interactive Charts**: Multi-axis visualization with Chart.js
- **Real-time Processing**: Live feedback during PDF processing
- **Export Options**: JSON, CSV download buttons

## ðŸ“š Documentation

- **Database Schema**: See [`database.md`](./database.md)
- **API Documentation**: Route handlers in `cmd/blowing-simulator/main.go`
- **Parser Logic**: Individual parsers in `internal/simulator/`

## ðŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## ðŸ“„ License

This project is licensed under the MIT License - see the LICENSE file for details.

```
BlowingSimulator/
â”œâ”€â”€ api/                # (empty) Reserved for future API endpoints
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ blowing-simulator/   # Main web server entrypoint
â”‚   â””â”€â”€ parse2json.go        # CLI tool for TXTâ†’JSON parsing
â”œâ”€â”€ docs/               # (empty) Reserved for documentation
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/         # (empty) Reserved for configuration logic
â”‚   â”œâ”€â”€ fremco/         # (empty) Reserved for Fremco-specific logic
â”‚   â”œâ”€â”€ jetting/        # (empty) Reserved for Jetting-specific logic
â”‚   â””â”€â”€ simulator/
â”‚       â”œâ”€â”€ normalize.go      # Normalization functions for Jetting/Fremco TXT
â”‚       â”œâ”€â”€ parse_fremco.go   # Fremco TXT parser
â”‚       â””â”€â”€ parse_jetting.go  # Jetting TXT parser
â”œâ”€â”€ pkg/                # (empty) Reserved for reusable packages
â”œâ”€â”€ scripts/            # (empty) Reserved for utility scripts
â”œâ”€â”€ test/               # (empty) Reserved for unit tests and sample files
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ static/         # Static assets (CSS, JS, images)
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ pdf2text.html     # Main web UI template
â”œâ”€â”€ go.mod              # Go module definition
â”œâ”€â”€ go.sum              # Go dependencies checksum
```

---

## Project Overview

### Purpose

Blowing Simulator extracts measurement data from PDF reports generated by Jetting and Fremco machines. It normalizes and parses the data into a unified JSON schema for further analysis or export.

### Supported Formats

- **Jetting TXT**: Multiple layouts supported (block, vertical-block, flat-table, row-oriented, and fallback scanning).
- **Fremco MicroFlow LOG**: Table format, parsed using `pdftotext` for reliable extraction.

### Key Features

- **PDF to Text Extraction**:
  - Jetting: Uses Go-native extraction (`ledongthuc/pdf`) for best results with Jetting layouts.
  - Fremco: Uses external `pdftotext` CLI for robust table extraction, ensuring Fremco tables are parsed correctly.
- **Automatic Format Detection**: Detects Jetting or Fremco format based on keywords in the extracted text.
- **Normalization & Parsing**: Cleans up extracted text and parses into rows aligned by distance (`LÃ¤nge`/`StreckenlÃ¤nge`), supporting multiple Jetting layouts and Fremco tables.
- **Uniform JSON Output**: Outputs a JSON array of `SimpleMeasurement` objects for both formats:
  - `length` (float64)
  - `speed` (float64)
  - `pressure` (float64)
  - `torque` (int, rounded)
  - `datetime` (optional, if available in source)
- **Web UI**:
  - Upload PDF, view extracted text, view and download JSON.
  - See parsed measurements in a dynamic HTML table.
  - Visualize measurements with a Chart.js multi-axis graph (speed, pressure, torque vs. length).
- **HTML Report**: Professional report with table and graph, matching the look of original machine reports.
- **CLI Tool**: Parse normalized TXT files to JSON outside the web UI for batch or automated processing.

### How It Works

1. **Upload PDF** via the web UI.
2. **Extract text**:
   - Jetting: Go-native extractor.
   - Fremco: `pdftotext` CLI.
3. **Automatic format detection** chooses the correct parser.
4. **Normalize text** to remove artifacts and prepare for parsing.
5. **Parse measurements** into unified JSON rows.
6. **View HTML report**:
   - See extracted text for debugging.
   - See parsed measurements in a table.
   - View a multi-axis graph (speed, pressure, torque vs. length).
7. **Download JSON** or use CLI for batch processing.

---

## Development Notes

- **Extensible**: Directory structure allows for future expansion (API, tests, docs, etc.).
- **Robust Parsing**: Handles noisy extraction, multiple Jetting layouts (block, vertical-block, flat-table, row-oriented, fallback) and Fremco tables, skips incomplete rows.
- **Error Handling**: Fails gracefully if extraction or parsing fails, with clear UI feedback.
- **HTML Report**: Table and graph are generated dynamically from parsed JSON, matching the style of original machine reports.
- **Unit Tests**: (To be added) Place sample TXT files and test cases in `/test`.

---

## Getting Started

1. **Install Go** (>=1.18).
2. **Install pdftotext** (Poppler) for Fremco parsing.
3. **Build and run** the web server:
   ```
   cd BlowingSimulator/cmd/blowing-simulator
   go run main.go
   ```
4. **Upload a PDF** via the web UI.
5. **View the HTML report** with table and graph.
6. **Download the parsed JSON** for further analysis.

---

## Contributing

- Add sample TXT files and unit tests to `/test`.
- Extend normalization and parsing logic in `/internal/simulator/`.
- Improve UI and HTML report in `/web/templates/pdf2text.html`.
- Add new features (CSV export, batch processing, metadata tables, etc.).

---

## License

MIT License (add LICENSE file as needed).

---
